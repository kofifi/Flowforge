import{j as e}from"./index-BQ9o7mEa.js";import{r}from"./reactflow-CgyvNGsb.js";import{u as E}from"./useThemePreference-BiXiARFG.js";import{I as S}from"./Icon-UISONTKN.js";import{b as $,u as L}from"./vendor-t4Ks9Nel.js";function A(){return{language:"en",setLanguage:()=>{},toggleLanguage:()=>{}}}const f="".replace(/\/$/,"");function g(a){const n=new Date(a);return Number.isNaN(n.getTime())?"—":n.toLocaleString()}function b(a){if(Array.isArray(a))return a.map(String);if(a&&typeof a=="object"&&"$values"in a){const n=a.$values;if(Array.isArray(n))return n.map(String)}return[]}function O(a){const n=a.trim();if(!n.startsWith("{")&&!n.startsWith("["))return a;try{return JSON.parse(n)}catch{return a}}function W(a){return a?Object.fromEntries(Object.entries(a).map(([n,s])=>typeof s=="string"?[n,O(s)]:[n,s])):{}}function M(){const{id:a}=$(),n=Number(a),[s,w]=r.useState(null),[p,o]=r.useState(!0),[d,m]=r.useState(null),{language:v}=A(),{theme:j,toggleTheme:k}=E(),h=L();r.useEffect(()=>{let l=!1;async function t(){if(!Number.isFinite(n)){m("Invalid execution id."),o(!1);return}o(!0),m(null);try{const c=await fetch(`${f}/api/WorkflowExecution/${n}`);if(!c.ok)throw new Error(`Failed to load execution (${c.status})`);const y=await c.json();l||w(y)}catch(c){l||m(c instanceof Error?c.message:"Unable to load execution")}finally{l||o(!1)}}return t(),()=>{l=!0}},[n]);const N=r.useMemo(()=>p?"Loading execution...":d||(s?"":"Execution not found."),[d,s,v,p]),i=r.useMemo(()=>b(s==null?void 0:s.actions),[s==null?void 0:s.actions]),u=r.useMemo(()=>b(s==null?void 0:s.path),[s==null?void 0:s.path]),x=r.useMemo(()=>u.map((l,t)=>({label:l,note:i[t]??void 0,index:t+1})),[i,u]);return e.jsxs("div",{className:"app-shell",children:[e.jsxs("aside",{className:"sidebar",children:[e.jsxs("div",{className:"brand",children:[e.jsx("span",{className:"brand-mark",children:"F"}),e.jsxs("div",{children:[e.jsx("p",{className:"brand-name",children:"Flowforge"}),e.jsx("p",{className:"brand-subtitle",children:"Workflow Studio"})]})]}),e.jsxs("nav",{className:"nav",children:[e.jsx("button",{type:"button",className:"nav-item",onClick:()=>h("/"),children:"Workflows"}),e.jsx("button",{type:"button",className:"nav-item",onClick:()=>h("/blocks"),children:"Blocks"}),e.jsx("button",{type:"button",className:"nav-item active",onClick:()=>h("/executions"),children:"Executions"})]}),e.jsxs("div",{className:"sidebar-footer",children:[e.jsx("p",{children:"Connected to local API"}),e.jsx("span",{className:"pill",children:f||"proxy /api"})]})]}),e.jsxs("main",{className:"main",children:[e.jsxs("header",{className:"topbar",children:[e.jsxs("div",{children:[e.jsxs("h1",{children:["Execution"," #",(s==null?void 0:s.id)??n]}),e.jsx("p",{className:"subtitle",children:"Full run details and outputs."})]}),e.jsxs("div",{className:"topbar-meta",children:[e.jsx("span",{className:"count",children:s?g(s.executedAt):"—"}),e.jsx("span",{className:"pill",children:"Run"}),e.jsx("button",{type:"button",className:"icon-button",onClick:k,"aria-label":`Switch to ${j==="dark"?"light":"dark"} mode`,children:e.jsx(S,{name:j==="dark"?"sun":"moon"})})]})]}),N?e.jsx("div",{className:"state",children:N}):e.jsxs(e.Fragment,{children:[e.jsxs("section",{className:"panel",children:[e.jsxs("div",{className:"panel-header",children:[e.jsx("h2",{children:"Overview"}),e.jsx("p",{className:"muted",children:"Workflow and run metadata."})]}),e.jsxs("div",{className:"execution-grid",children:[e.jsxs("div",{className:"execution-card",children:[e.jsx("p",{className:"label",children:"Workflow"}),e.jsx("p",{className:"meta",children:(s==null?void 0:s.workflowName)??`Workflow #${s==null?void 0:s.workflowId}`})]}),e.jsxs("div",{className:"execution-card",children:[e.jsx("p",{className:"label",children:"Executed at"}),e.jsx("p",{className:"meta",children:s?g(s.executedAt):"—"})]}),e.jsxs("div",{className:"execution-card",children:[e.jsx("p",{className:"label",children:"Path length"}),e.jsx("p",{className:"meta",children:u.length})]})]})]}),e.jsxs("section",{className:"panel",children:[e.jsxs("div",{className:"panel-header",children:[e.jsx("h2",{children:"Inputs"}),e.jsx("p",{className:"muted",children:"Variables passed into the run."})]}),e.jsx("div",{className:"drawer-empty",children:e.jsx("pre",{className:"meta",children:JSON.stringify((s==null?void 0:s.inputData)??{},null,2)})})]}),e.jsxs("section",{className:"panel",children:[e.jsxs("div",{className:"panel-header",children:[e.jsx("h2",{children:"Results"}),e.jsx("p",{className:"muted",children:"Output variables produced by the workflow."})]}),e.jsx("div",{className:"drawer-empty",children:e.jsx("pre",{className:"meta",children:JSON.stringify(W(s==null?void 0:s.resultData),null,2)})})]}),e.jsxs("section",{className:"panel",children:[e.jsxs("div",{className:"panel-header",children:[e.jsx("h2",{children:"Path"}),e.jsx("p",{className:"muted",children:"Order of block execution with a quick flow map."})]}),x.length>0?e.jsx("div",{className:"flow-wrapper",children:e.jsx("div",{className:"flow-lane flow-scroll",children:x.map((l,t)=>e.jsxs("div",{className:"flow-segment",children:[e.jsxs("div",{className:"flow-node",children:[e.jsxs("div",{className:"flow-node-top",children:[e.jsx("span",{className:"flow-index",children:l.index}),e.jsx("span",{className:"flow-badge",children:"Executed"})]}),e.jsx("span",{className:"flow-label",children:l.label}),l.note&&e.jsx("span",{className:"flow-note",children:l.note})]}),t<x.length-1&&e.jsx("div",{className:"flow-connector"})]},`${l.label}-${t}`))})}):e.jsx("div",{className:"state",children:"No path recorded."})]}),e.jsxs("section",{className:"panel",children:[e.jsxs("div",{className:"panel-header",children:[e.jsx("h2",{children:"Actions"}),e.jsx("p",{className:"muted",children:"Detailed execution logs."})]}),i.length>0?e.jsx("ul",{className:"executions-list",children:i.map((l,t)=>e.jsx("li",{className:"execution-card",children:e.jsx("p",{className:"meta",children:l})},`${l}-${t}`))}):e.jsx("div",{className:"state",children:"No actions recorded."})]})]})]})]})}export{M as default};
