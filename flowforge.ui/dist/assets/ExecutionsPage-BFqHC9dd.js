import{j as e}from"./index-BQ9o7mEa.js";import{r as l}from"./reactflow-CgyvNGsb.js";import{u as X}from"./useThemePreference-BiXiARFG.js";import{I as Y}from"./Icon-UISONTKN.js";import{u as Z}from"./vendor-t4Ks9Nel.js";const z="".replace(/\/$/,"");function _(n){if(Array.isArray(n))return n;if(n&&typeof n=="object"&&"$values"in n){const i=n.$values;return Array.isArray(i)?i:[]}return[]}function ee(n){const i=new Date(n);return Number.isNaN(i.getTime())?"—":i.toLocaleString()}function oe(){var R;const[n,i]=l.useState([]),[M,k]=l.useState(!0),[y,L]=l.useState(null),[x,I]=l.useState(""),[h,W]=l.useState("all"),[u,S]=l.useState(""),[m,C]=l.useState(""),[g,$]=l.useState("newest"),[f,w]=l.useState(1),[p,V]=l.useState(10),E=l.useRef(null),{theme:A,toggleTheme:q}=X(),j=Z();l.useEffect(()=>{let s=!1;async function a(){if(E.current){i(E.current),k(!1);return}k(!0),L(null);try{const o=await fetch(`${z}/api/WorkflowExecution`);if(!o.ok)throw new Error(`Failed to load executions (${o.status})`);const b=await o.json();if(!s){const r=_(b);E.current=r,i(r)}}catch(o){s||L(o instanceof Error?o.message:"Unable to load executions")}finally{s||k(!1)}}return a(),()=>{s=!0}},[]);const F=l.useMemo(()=>{const s=new Map;return n.forEach(a=>{const o=a.workflowName??`Workflow #${a.workflowId}`;s.set(a.workflowId,o)}),Array.from(s.entries()).sort((a,o)=>a[1].localeCompare(o[1]))},[n]),c=l.useMemo(()=>{const s=x.trim().toLowerCase(),a=u?new Date(`${u}T00:00:00`):null,o=m?new Date(`${m}T23:59:59.999`):null;return[...n].sort((r,B)=>{const N=new Date(r.executedAt).getTime(),v=new Date(B.executedAt).getTime();return g==="newest"?v-N:N-v}).filter(r=>{const N=`${r.workflowName??`Workflow #${r.workflowId}`} ${r.workflowId}`.toLowerCase(),v=!s||N.includes(s),G=h==="all"||String(r.workflowId)===h,T=new Date(r.executedAt),O=!Number.isNaN(T.getTime()),J=!a||O&&T>=a,K=!o||O&&T<=o;return v&&G&&J&&K})},[n,u,x,g,m,h]),d=l.useMemo(()=>Math.max(1,Math.ceil(c.length/p)),[c.length,p]);l.useEffect(()=>{w(s=>Math.min(Math.max(1,s),d))},[d,c.length]);const H=l.useMemo(()=>{const s=(f-1)*p;return c.slice(s,s+p)},[c,f,p]);function Q(s){const a=Number(s);Number.isFinite(a)&&w(Math.min(d,Math.max(1,a)))}const t={navWorkflows:"Workflows",navBlocks:"Blocks",navExecutions:"Executions",title:"Executions",subtitle:"Recent workflow runs and timestamps.",history:"History",sectionTitle:"Execution history",sectionSubtitle:"Search and filter workflow runs by name, date, or recency.",searchLabel:"Search",searchPlaceholder:"Search by workflow name or id...",workflowLabel:"Workflow",allWorkflows:"All workflows",between:"Executed between",sortLabel:"Sort",newest:"Newest first",oldest:"Oldest first",last24h:"Last 24h",last7d:"Last 7 days",last30d:"Last 30 days",showing:"Showing",fromTotal:"from",totalRecords:"total records",reset:"Reset filters",prev:"Prev",next:"Next",page:"Page",of:"of",rows:"Rows",loading:"Loading executions...",none:"No executions yet.",noMatch:"No matches for current filters.",viewDetails:"View details",openWorkflow:"Open workflow"},P=l.useMemo(()=>M?t.loading:y||(n.length===0?t.none:c.length===0?t.noMatch:""),[t.loading,t.noMatch,t.none,y,n.length,c.length,M]);function D(s){const a=new Date,o=new Date(a);o.setDate(a.getDate()-(s-1));const b=a.toISOString().slice(0,10),r=o.toISOString().slice(0,10);S(r),C(b)}function U(){I(""),W("all"),S(""),C(""),$("newest")}return e.jsxs("div",{className:"app-shell",children:[e.jsxs("aside",{className:"sidebar",children:[e.jsxs("div",{className:"brand",children:[e.jsx("span",{className:"brand-mark",children:"F"}),e.jsxs("div",{children:[e.jsx("p",{className:"brand-name",children:"Flowforge"}),e.jsx("p",{className:"brand-subtitle",children:"Workflow Studio"})]})]}),e.jsxs("nav",{className:"nav",children:[e.jsx("button",{type:"button",className:"nav-item",onClick:()=>j("/"),children:t.navWorkflows}),e.jsx("button",{type:"button",className:"nav-item",onClick:()=>j("/blocks"),children:t.navBlocks}),e.jsx("button",{type:"button",className:"nav-item active",children:t.navExecutions})]}),e.jsxs("div",{className:"sidebar-footer",children:[e.jsx("p",{children:"Connected to local API"}),e.jsx("span",{className:"pill",children:z||"proxy /api"})]})]}),e.jsxs("main",{className:"main",children:[e.jsxs("header",{className:"topbar",children:[e.jsxs("div",{children:[e.jsx("h1",{children:t.title}),e.jsx("p",{className:"subtitle",children:t.subtitle})]}),e.jsxs("div",{className:"topbar-meta",children:[e.jsx("button",{type:"button",className:"icon-button",onClick:q,"aria-label":`Switch to ${A==="dark"?"light":"dark"} mode`,children:e.jsx(Y,{name:A==="dark"?"sun":"moon"})}),e.jsxs("span",{className:"count",children:[n.length," total"]}),e.jsx("span",{className:"pill",children:t.history})]})]}),e.jsxs("section",{className:"panel",children:[e.jsxs("div",{className:"panel-header",children:[e.jsx("h2",{children:t.sectionTitle}),e.jsx("p",{className:"muted",children:t.sectionSubtitle})]}),e.jsxs("div",{className:"filter-bar",children:[e.jsxs("div",{className:"filter-grid",children:[e.jsxs("label",{className:"filter-group",children:[e.jsx("span",{children:t.searchLabel}),e.jsx("input",{type:"text",placeholder:t.searchPlaceholder,value:x,onChange:s=>I(s.target.value)})]}),e.jsxs("label",{className:"filter-group",children:[e.jsx("span",{children:t.workflowLabel}),e.jsxs("select",{value:h,onChange:s=>W(s.target.value),children:[e.jsx("option",{value:"all",children:t.allWorkflows}),F.map(([s,a])=>e.jsx("option",{value:String(s),children:a},s))]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("span",{children:t.between}),e.jsxs("div",{className:"date-range",children:[e.jsx("input",{type:"date",value:u,onChange:s=>S(s.target.value),"aria-label":"Executed from"}),e.jsx("span",{className:"date-separator",children:"to"}),e.jsx("input",{type:"date",value:m,onChange:s=>C(s.target.value),"aria-label":"Executed to"})]})]}),e.jsxs("label",{className:"filter-group",children:[e.jsx("span",{children:t.sortLabel}),e.jsxs("select",{value:g,onChange:s=>$(s.target.value),children:[e.jsx("option",{value:"newest",children:t.newest}),e.jsx("option",{value:"oldest",children:t.oldest})]})]})]}),e.jsxs("div",{className:"filter-actions",children:[e.jsxs("div",{className:"quick-filters",children:[e.jsx("button",{type:"button",className:"ghost tiny",onClick:()=>D(1),children:t.last24h}),e.jsx("button",{type:"button",className:"ghost tiny",onClick:()=>D(7),children:t.last7d}),e.jsx("button",{type:"button",className:"ghost tiny",onClick:()=>D(30),children:t.last30d})]}),e.jsxs("div",{className:"filter-footer",children:[e.jsxs("div",{className:"badges",children:[e.jsxs("span",{className:"chip",children:[t.showing," ",c.length]}),c.length!==n.length&&e.jsxs("span",{className:"chip ghost",children:[t.fromTotal," ",n.length," ",t.totalRecords]}),h!=="all"&&e.jsxs("span",{className:"chip ghost",children:[t.workflowLabel,":"," ",(R=F.find(([s])=>String(s)===h))==null?void 0:R[1]]}),x.trim()&&e.jsxs("span",{className:"chip ghost",children:[t.searchLabel,": “",x.trim(),"”"]}),u&&e.jsxs("span",{className:"chip ghost",children:["From",": ",u]}),m&&e.jsxs("span",{className:"chip ghost",children:["To",": ",m]}),g==="oldest"&&e.jsx("span",{className:"chip ghost",children:t.oldest})]}),e.jsx("button",{type:"button",className:"ghost",onClick:U,children:t.reset})]}),e.jsxs("div",{className:"pagination",children:[e.jsxs("div",{className:"page-controls",children:[e.jsx("button",{type:"button",className:"ghost",onClick:()=>w(s=>Math.max(1,s-1)),disabled:f<=1,children:t.prev}),e.jsxs("span",{className:"page-info",children:[t.page," ",e.jsx("input",{type:"number",min:1,max:d,value:f,onChange:s=>Q(s.target.value),className:"page-input"})," ",t.of," ",d]}),e.jsx("button",{type:"button",onClick:()=>w(s=>Math.min(d,s+1)),disabled:f>=d,children:t.next})]}),e.jsxs("label",{className:"page-size",children:[e.jsx("span",{children:t.rows}),e.jsx("select",{value:p,onChange:s=>{V(Number(s.target.value)),w(1)},children:[5,10,20,50].map(s=>e.jsx("option",{value:s,children:s},s))})]})]})]})]}),P?e.jsx("div",{className:"state",children:P}):e.jsx("ul",{className:"executions-list",children:H.map(s=>e.jsxs("li",{className:"execution-card",children:[e.jsxs("div",{children:[e.jsx("p",{className:"label",children:s.workflowName??`Workflow #${s.workflowId}`}),e.jsxs("p",{className:"meta",children:["Executed:"," ",ee(s.executedAt)]})]}),e.jsxs("div",{className:"card-actions",children:[e.jsx("button",{type:"button",onClick:()=>j(`/executions/${s.id}`),children:t.viewDetails}),e.jsx("button",{type:"button",className:"ghost",onClick:()=>j(`/workflows/${s.workflowId}`),children:t.openWorkflow})]})]},s.id))})]})]})]})}export{oe as default};
