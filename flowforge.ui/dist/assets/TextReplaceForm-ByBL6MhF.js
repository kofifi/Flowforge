import{j as s}from"./index-BQ9o7mEa.js";import{r as g}from"./reactflow-CgyvNGsb.js";import{I as h}from"./Icon-UISONTKN.js";import{V}from"./VariableSelect-DF1e_AzG.js";import"./vendor-t4Ks9Nel.js";function k({panelId:t,variables:N,config:i,setTextReplaceConfigs:o,markDirty:m}){const b=N.map(a=>`$${a.name}`),[n,x]=g.useState(i.replacements&&i.replacements.length>0?i.replacements:[{from:"",to:"",useRegex:!1,ignoreCase:!1}]);g.useEffect(()=>{const a=i.replacements&&i.replacements.length>0?i.replacements:[{from:"",to:"",useRegex:!1,ignoreCase:!1}];x(a)},[i.replacements]);const d=a=>{const e=a.trim();return e.startsWith("$")?e.slice(1):e},j=a=>a.trim()?a.startsWith("$")?a:`$${a}`:"",u=a=>{x(a),o(e=>{var l,r,c;return{...e,[t]:{input:((l=e[t])==null?void 0:l.input)??i.input??"",inputVariable:((r=e[t])==null?void 0:r.inputVariable)??i.inputVariable??"",resultVariable:((c=e[t])==null?void 0:c.resultVariable)??i.resultVariable??"result",replacements:a}}}),m()},p=(a,e)=>{const l=n.map((r,c)=>c===a?{...r,...e}:r);u(l)},v=()=>{u([...n,{from:"",to:"",useRegex:!1,ignoreCase:!1}])},f=a=>{const e=n.filter((l,r)=>r!==a);u(e.length>0?e:[{from:"",to:"",useRegex:!1,ignoreCase:!1}])};return s.jsxs(s.Fragment,{children:[s.jsxs("label",{htmlFor:"replace-input",className:"drawer-label",children:[s.jsx("span",{className:"label-icon",children:s.jsx(h,{name:"rows"})}),"Input text (literal)"]}),s.jsx("input",{id:"replace-input",type:"text",placeholder:"Original text",value:i.input??"",onChange:a=>{const e=a.target.value;o(l=>{var r,c;return{...l,[t]:{...l[t],input:e,inputVariable:((r=l[t])==null?void 0:r.inputVariable)??"",resultVariable:((c=l[t])==null?void 0:c.resultVariable)??"result",replacements:n}}}),m()}}),s.jsx(V,{id:"replace-input-variable",label:"Or variable (overrides literal)",value:j(i.inputVariable??""),options:b,placeholder:"$text",onValueChange:a=>{o(e=>{var l,r;return{...e,[t]:{...e[t],inputVariable:d(a),input:((l=e[t])==null?void 0:l.input)??"",resultVariable:((r=e[t])==null?void 0:r.resultVariable)??"result",replacements:n}}}),m()},showHints:!1,trailingAction:i.inputVariable?s.jsx("button",{type:"button",className:"ghost",onClick:()=>{o(a=>{var e,l;return{...a,[t]:{...a[t],inputVariable:"",input:((e=a[t])==null?void 0:e.input)??"",resultVariable:((l=a[t])==null?void 0:l.resultVariable)??"result",replacements:n}}}),m()},children:"Clear"}):null}),s.jsxs("div",{className:"section-header",style:{marginTop:12},children:[s.jsxs("div",{children:[s.jsx("p",{className:"section-title",children:"Replacements"}),s.jsxs("span",{className:"section-subtitle",children:[n.length," rule(s)"]})]}),s.jsx("button",{type:"button",className:"ghost",onClick:v,children:"Add rule"})]}),s.jsx("div",{className:"card stack",style:{gap:10},children:n.map((a,e)=>s.jsxs("div",{className:"card",style:{padding:12,gap:8},children:[s.jsxs("div",{className:"grid",style:{gridTemplateColumns:"1fr 1fr",gap:8},children:[s.jsxs("div",{className:"combo",children:[s.jsxs("label",{className:"drawer-label",htmlFor:`replace-from-${e}`,children:[s.jsx("span",{className:"label-icon",children:s.jsx(h,{name:"rows"})}),"From"]}),s.jsx("input",{id:`replace-from-${e}`,type:"text",value:a.from,onChange:l=>p(e,{from:l.target.value})})]}),s.jsxs("div",{className:"combo",children:[s.jsxs("label",{className:"drawer-label",htmlFor:`replace-to-${e}`,children:[s.jsx("span",{className:"label-icon",children:s.jsx(h,{name:"rows"})}),"To"]}),s.jsx("input",{id:`replace-to-${e}`,type:"text",value:a.to,onChange:l=>p(e,{to:l.target.value})})]})]}),s.jsxs("div",{className:"row",style:{display:"flex",gap:12,alignItems:"center"},children:[s.jsxs("label",{className:"switch",style:{marginRight:12},children:[s.jsx("input",{type:"checkbox",checked:a.useRegex===!0,onChange:l=>p(e,{useRegex:l.target.checked})}),s.jsx("span",{className:"switch-slider"}),s.jsx("span",{className:"muted",children:"Use regex"})]}),s.jsxs("label",{className:"switch",style:{marginRight:"auto"},children:[s.jsx("input",{type:"checkbox",checked:a.ignoreCase===!0,onChange:l=>p(e,{ignoreCase:l.target.checked})}),s.jsx("span",{className:"switch-slider"}),s.jsx("span",{className:"muted",children:"Ignore case"})]}),n.length>1&&s.jsx("button",{type:"button",className:"ghost",onClick:()=>f(e),children:"Remove"})]})]},`replace-${e}`))}),s.jsx(V,{id:"replace-result",label:"Result variable",placeholder:"$result",value:j(i.resultVariable??"result"),options:b,onValueChange:a=>{o(e=>{var l,r;return{...e,[t]:{...e[t],input:((l=e[t])==null?void 0:l.input)??"",inputVariable:((r=e[t])==null?void 0:r.inputVariable)??"",resultVariable:d(a)||"result",replacements:n}}}),m()},showHints:!1}),s.jsx("p",{className:"muted",children:"Rules are applied in order. Regex rules are capped for safety; invalid patterns are skipped."})]})}export{k as default};
