import{j as e}from"./index-BQ9o7mEa.js";import{r as l}from"./reactflow-CgyvNGsb.js";import{u as H}from"./useThemePreference-BiXiARFG.js";import{I as z}from"./Icon-UISONTKN.js";import{u as M}from"./vendor-t4Ks9Nel.js";const p="".replace(/\/$/,"");function q(c){if(Array.isArray(c))return c;if(c&&typeof c=="object"&&"$values"in c){const d=c.$values;return Array.isArray(d)?d:[]}return[]}function Y(){const[c,d]=l.useState([]),[S,b]=l.useState(!0),[N,i]=l.useState(null),m=l.useRef(null),[x,$]=l.useState(""),[u,W]=l.useState(null),[k,y]=l.useState(""),[h,f]=l.useState(!1),[g,C]=l.useState(!1),[U,T]=l.useState(null),{theme:O,toggleTheme:L}=H(),j=M(),R=c.length>0,o={navWorkflows:"Workflows",navBlocks:"Blocks",navExecutions:"Executions",title:"Workflow projects",subtitle:"Manage projects before wiring blocks and connections in React Flow.",createTitle:"Create new workflow",createHint:"Use a short, descriptive name.",importTitle:"Import / Export",importHint:"Download a workflow JSON or import one as a new project.",open:"Open",export:"Export",rename:"Rename",delete:"Delete"},F=l.useMemo(()=>S?"Loading workflows...":N||(R?"":"No workflows yet. Create your first project."),[N,R,S]);l.useEffect(()=>{let t=!1;async function s(){if(m.current){d(m.current),b(!1);return}b(!0),i(null);try{const a=await fetch(`${p}/api/Workflow`);if(!a.ok)throw new Error(`Failed to load workflows (${a.status})`);const n=await a.json();if(!t){const r=q(n);m.current=r,d(r)}}catch(a){t||i(a instanceof Error?a.message:"Unable to load workflows")}finally{t||b(!1)}}return s(),()=>{t=!0}},[]);async function I(t){if(t.preventDefault(),!(!x.trim()||h)){f(!0),i(null);try{const s=await fetch(`${p}/api/Workflow`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:x.trim()})});if(!s.ok)throw new Error(`Failed to create workflow (${s.status})`);const a=await s.json();d(n=>{const r=[a,...n];return m.current=r,r}),$(""),j(`/workflows/${a.id}`)}catch(s){i(s instanceof Error?s.message:"Unable to create workflow")}finally{f(!1)}}}function D(t){W(t.id),y(t.name)}function v(){W(null),y("")}async function J(t){if(t.preventDefault(),u===null||h)return;const s=k.trim();if(s){f(!0),i(null);try{const a=await fetch(`${p}/api/Workflow/${u}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:u,name:s})});if(!a.ok)throw new Error(`Failed to update workflow (${a.status})`);d(n=>n.map(r=>r.id===u?{...r,name:s}:r)),m.current=(m.current??[]).map(n=>n.id===u?{...n,name:s}:n),v()}catch(a){i(a instanceof Error?a.message:"Unable to update workflow")}finally{f(!1)}}}async function P(t){if(!h){f(!0),i(null);try{const s=await fetch(`${p}/api/Workflow/${t}`,{method:"DELETE"});if(!s.ok)throw new Error(`Failed to delete workflow (${s.status})`);d(a=>a.filter(n=>n.id!==t)),m.current=(m.current??[]).filter(a=>a.id!==t),u===t&&v()}catch(s){i(s instanceof Error?s.message:"Unable to delete workflow")}finally{f(!1)}}}async function A(t,s){try{const a=await fetch(`${p}/api/Workflow/${t}/export`);if(!a.ok)throw new Error(`Export failed (${a.status})`);const n=await a.json(),r=new Blob([JSON.stringify(n,null,2)],{type:"application/json"}),w=URL.createObjectURL(r),E=document.createElement("a");E.href=w,E.download=`${s||"workflow"}-${t}.json`,E.click(),URL.revokeObjectURL(w)}catch(a){i(a instanceof Error?a.message:"Unable to export workflow")}}async function B(t){C(!0),T(null),i(null);try{const s=await t.text(),a=JSON.parse(s),n=await fetch(`${p}/api/Workflow/import`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!n.ok)throw new Error(`Import failed (${n.status})`);const r=await n.json();T(`Imported as "${r.name}" (id ${r.id}).`),d(w=>[r,...w])}catch(s){i(s instanceof Error?s.message:"Unable to import workflow")}finally{C(!1)}}return e.jsxs("div",{className:"app-shell",children:[e.jsxs("aside",{className:"sidebar",children:[e.jsxs("div",{className:"brand",children:[e.jsx("span",{className:"brand-mark",children:"F"}),e.jsxs("div",{children:[e.jsx("p",{className:"brand-name",children:"Flowforge"}),e.jsx("p",{className:"brand-subtitle",children:"Workflow Studio"})]})]}),e.jsxs("nav",{className:"nav",children:[e.jsx("button",{type:"button",className:"nav-item active",children:o.navWorkflows}),e.jsx("button",{type:"button",className:"nav-item",onClick:()=>j("/blocks"),children:o.navBlocks}),e.jsx("button",{type:"button",className:"nav-item",onClick:()=>j("/executions"),children:o.navExecutions})]}),e.jsxs("div",{className:"sidebar-footer",children:[e.jsx("p",{children:"Connected to local API"}),e.jsx("span",{className:"pill",children:p||"proxy /api"})]})]}),e.jsxs("main",{className:"main",children:[e.jsxs("header",{className:"topbar",children:[e.jsxs("div",{children:[e.jsx("h1",{children:o.title}),e.jsx("p",{className:"subtitle",children:o.subtitle})]}),e.jsxs("div",{className:"topbar-meta",children:[e.jsx("button",{type:"button",className:"icon-button",onClick:L,"aria-label":`Switch to ${O==="dark"?"light":"dark"} mode`,children:e.jsx(z,{name:O==="dark"?"sun":"moon"})}),e.jsxs("span",{className:"count",children:[c.length," total"]}),e.jsx("span",{className:"pill",children:"CRUD ready"})]})]}),e.jsxs("section",{className:"panel",children:[e.jsxs("div",{className:"panel-header",children:[e.jsx("h2",{children:o.createTitle}),e.jsx("p",{className:"muted",children:o.createHint})]}),e.jsxs("form",{className:"create-form",onSubmit:I,children:[e.jsx("label",{htmlFor:"workflow-name",children:"Workflow name"}),e.jsxs("div",{className:"create-controls",children:[e.jsx("input",{id:"workflow-name",type:"text",value:x,onChange:t=>$(t.target.value),placeholder:"e.g. Customer onboarding",maxLength:120}),e.jsx("button",{type:"submit",disabled:!x.trim()||h,children:"Create"})]})]})]}),e.jsxs("section",{className:"panel",children:[e.jsxs("div",{className:"panel-header",children:[e.jsx("h2",{children:o.importTitle}),e.jsx("p",{className:"muted",children:o.importHint})]}),e.jsxs("div",{className:"import-export",children:[e.jsxs("div",{className:"upload-card",children:[e.jsxs("div",{children:[e.jsx("p",{className:"label",children:"Import workflow JSON"}),e.jsx("p",{className:"muted",children:"Select a .json file to create a new workflow."})]}),e.jsxs("label",{className:`upload-pill ${g?"disabled":""}`,children:[e.jsx("input",{type:"file",accept:"application/json",onChange:t=>{var a;const s=(a=t.target.files)==null?void 0:a[0];s&&(B(s),t.target.value="")},disabled:g}),e.jsx("span",{children:g?"Importingâ€¦":"Choose file"})]}),U&&e.jsx("p",{className:"meta",children:U})]}),e.jsxs("div",{className:"export-hint",children:[e.jsx("p",{className:"label",children:"Export"}),e.jsx("p",{className:"muted",children:"Use the Export button next to a workflow below."})]})]})]}),e.jsxs("section",{className:"panel",children:[e.jsxs("div",{className:"panel-header",children:[e.jsx("h2",{children:"Existing workflows"}),e.jsx("p",{className:"muted",children:"Rename or delete projects before building flows."})]}),F?e.jsx("div",{className:"state",children:F}):e.jsx("ul",{className:"workflow-list",children:c.map(t=>e.jsxs("li",{className:"workflow-card",children:[e.jsxs("div",{children:[e.jsx("p",{className:"label",children:"Workflow"}),u===t.id?e.jsxs("form",{className:"edit-form",onSubmit:J,children:[e.jsx("input",{type:"text",value:k,onChange:s=>y(s.target.value),maxLength:120,autoFocus:!0}),e.jsxs("div",{className:"card-actions",children:[e.jsx("button",{type:"submit",disabled:!k.trim()||h,children:"Save"}),e.jsx("button",{type:"button",onClick:v,className:"ghost",children:"Cancel"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("h3",{children:t.name}),e.jsxs("p",{className:"meta",children:["ID: ",t.id]})]})]}),u!==t.id&&e.jsxs("div",{className:"card-actions",children:[e.jsx("button",{type:"button",onClick:()=>j(`/workflows/${t.id}`),children:o.open}),e.jsx("button",{type:"button",onClick:()=>A(t.id,t.name),children:o.export}),e.jsx("button",{type:"button",onClick:()=>D(t),children:o.rename}),e.jsx("button",{type:"button",onClick:()=>P(t.id),className:"danger",children:o.delete})]})]},t.id))})]})]})]})}export{Y as default};
